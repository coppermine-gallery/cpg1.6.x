var redirURL="",h5u_albSel=null,stagger=!1;function $id(d){return document.getElementById(d)}function $ae(d,f,m){d.addEventListener(f,m,!1)}function H5up_done(d){var f=".php?album="+h5u_albSel.value;redirURL=0<js_vars.user_id||1==js_vars.guest_edit?js_vars.site_url+"/editpics"+f+"&newer_than="+js_vars.timestamp:js_vars.site_url+"/thumbnails"+f;"1"==js_vars.autoedit&&0===d?window.location=redirURL:$id("gotoedit").style.display="table-row"}
(function(d,f,m){function E(b){h5u_albSel.value||(b.stopPropagation(),b.preventDefault(),alert(js_vars.h5uM.selAlb))}function x(b){b.stopPropagation();b.preventDefault();b.target.className="dragover"==b.type?"hover":""}function A(b){var a,c;B=q.offsetWidth;x(b);if(h5u_albSel.value){y&&(y=r=t=0);b=b.target.files||b.dataTransfer.files;for(a=0;c=b[a];a++)r+=c.size,e.push(c),u.innerHTML=e.length,stagger||n(!1,"fsel");stagger&&n(!1,"fsel");e.length>v&&(l.style.display="inline-block")}else alert(js_vars.h5uM.selAlb)}
function C(){k||(y=1,typeof("function"==H5up_done)&&H5up_done(D))}function n(b,a){b&&(--g||C());if(!k&&e.length&&(!v||g<v)){var c=e.shift();new F(c);g++;u.innerHTML=e.length}0>=e.length&&(l.style.display="none",h.style.display="none")}function G(b,a){var c=this;c.show=function(a){c.pb.style.backgroundPosition=Math.floor(c.pb.offsetWidth*a)+"px 0";1===a&&(c.pb.innerHTML=c.fObj.fileName,c.pb.className="indeterm")};c.msg=function(a,b){c.pb.innerHTML+="<br />"+a;b&&(c.pb.className="failure",D++)};c.remove=
function(){c.pb._ufo=null;z.removeChild(c.pb);c.fObj=null};c.pb=z.appendChild(document.createElement("p"));a&&(c.pb.className=a);c.pb.appendChild(document.createTextNode(b.fileName));c.pb.innerHTML+='<img src="'+js_vars.H5uPath+'css/redX.png" class="abortX" onclick="this.parentNode._ufo.abort(true);" />';c.pb._ufo=b;c.fObj=b;return this}function w(b){!q||0>b||(t+=b,q.style.backgroundPosition=Math.floor(B*t/r)+"px 0")}function H(){var b={},a,c;for(a in m){c=m[a];var d=$id(c);if(d)switch(d.type){case "checkbox":b[c]=
d.checked?1:0;break;default:b[c]=d.value}}b.album=h5u_albSel.value;return b}function p(b,a){for(var c in a)b.append(c,a[c])}function F(b){var a=this;a.upFile=b;a.fileName=b.fileName||b.name;a.size=b.size;a.upState="";a.doChnk=a.upFile.size>js_vars.maxchunksize;a.chnkSize=Math.round(js_vars.maxchunksize/2)-3072;a.relPath=b.webkitRelativePath||a.fileName;a.uniqueId=a.size+"-"+a.relPath.replace(/[^0-9a-zA-Z_-]/img,"");a.actSize=0;a.startByte=0;a.lastsz=0;a.numChnks=Math.max(Math.floor(a.size/a.chnkSize),
1);a.chnkNum=0;a.fData=null;a.upForm=H();a.xhr=new XMLHttpRequest;var c=a.upFile.slice?"slice":a.upFile.mozSlice?"mozSlice":a.upFile.webkitSlice?"webkitSlice":"slice",d=function(b){a.xhr&&(a.xhr.upload.onprogress=null,a.xhr.onabort=null,a.xhr.onerror=null,a.xhr.onload=null,a.xhr=null);a.fData=null;b&&a.pBar&&(a.pBar.remove(),a.pBar=null);n(!0,"ufo")},e=function(){a.fData=new FormData;p(a.fData,js_vars.fup_payload)},l=function(){e();switch(a.upState){case "":p(a.fData,a.upForm);a.fData.append("Filedata",
a.upFile);a.upState="upld";break;case "upld":d(!0);return}a.xhr.open("POST",f);a.xhr.send(a.fData)},k=function(){e();switch(a.upState){case "":p(a.fData,{chunkact:"pref",file:a.fileName,size:a.size,album:h5u_albSel.value});a.upState="chnk";break;case "chnk":p(a.fData,{chunkact:"chnk",identifier:a.uniqueId,filename:a.fileName,totalChunks:a.numChnks});if(a.chnkNum==a.numChnks){d(!0);return}a.startByte=a.chnkNum*a.chnkSize;a.endByte=Math.min(a.size,(a.chnkNum+1)*a.chnkSize);a.size-a.endByte<a.chnkSize&&
(a.endByte=a.size);a.actSize=a.endByte-a.startByte;a.fData.append("chunkNumber",++a.chnkNum);a.chnkNum==a.numChnks&&p(a.fData,a.upForm);a.fData.append("Filedata",a.upFile[c](a.startByte,a.endByte));a.lastsz=0;break;case "abrt":a.xhr.timeout=1E4;p(a.fData,{chunkact:"abrt",identifier:a.uniqueId,filename:a.fileName});a.upState="nil";break;case "nil":d();return}a.xhr.open("POST",f);a.xhr.send(a.fData)},g={prog:function(b){if(b.lengthComputable){var c=Math.round(b.loaded/b.total*a.actSize);"chnk"==a.upState&&
a.chnkNum?(a.pBar.show((a.startByte+c)/a.size),w(c-a.lastsz),a.lastsz=c):"upld"==a.upState&&(a.pBar.show(b.loaded/b.total),c=Math.round(b.loaded/b.total*a.size),w(c-a.lastsz),a.lastsz=c)}},chng:function(b){4>this.readyState||(200!==this.status?(w(a.size-a.startByte-a.lastsz),a.lastsz=a.size,0===this.status?(a.pBar.msg("-- "+js_vars.h5uM.aborted,!0),a.doChnk?(a.upState="abrt",k()):d()):(a.pBar.msg(this.statusText||this.status,!0),d())):200===this.status&&(a.doChnk?k():l()))},fail:function(b){a.pBar.msg(a.xhr.statusText,
!0)}};a.abort=function(b){a.xhr?(b=a.xhr.readyState,4>b&&0!==b?a.xhr.abort():g.abrt()):(a.pBar.remove(),a.pBar=null)};a.pBar=new G(a,a.doChnk?"chunked":"");var h="",m=b.name.split(".");1==m.length||"object"==typeof js_vars.allowed_file_types&&0>js_vars.allowed_file_types.indexOf(m.pop().toLowerCase())?h='<img src="'+js_vars.H5uPath+'css/info.png" class="infog" onclick="showAllowedExts();" /> '+js_vars.h5uM.type_err:b.size>js_vars.maxfilesize&&(h=js_vars.h5uM.size_err);if(h)a.pBar.msg(h,!0),w(b.size),
a.xhr=null,n(!0,"errM");else return a.xhr.onreadystatechange=g.chng,a.xhr.upload.onerror=g.fail,a.xhr.upload.onprogress=g.prog,a.doChnk?k():l(),this}var q,B,z,u,e=[],v=js_vars.concurrent,k=!1,g=0,r=0,t=0,y=0,D=0,l,h;d.H5uSetup=function(){var b=$id("upload_field"),a=$id("dropArea");d.File&&d.FileList?(u=$id("qcount"),l=$id("qstop"),h=$id("qgocan"),b&&($ae(b,"click",E),$ae(b,"change",A)),b=new XMLHttpRequest,b.upload&&($ae(a,"dragover",x),$ae(a,"dragleave",x),$ae(a,"drop",A),a.style.display="block",
q=$id("totprogress"),z=$id("fprogress")),h5u_albSel=document.getElementsByName("h5u_album")[0]):($id("h5upldrow").style.display="none",$id("navailrow").style.display="table-row")};d.H5uQctrl={stop:function(){k=!0;l.style.display="none";h.style.display="inline-block"},go:function(){k=!1;l.style.display="inline-block";h.style.display="none";if(stagger)n(!1,"go");else for(;e.length&&g<v;)n(!1,"go")},cancel:function(){e.length=0;k=!1;h.style.display="none";u.innerHTML=0;g||C()}}})(window,"uniload.php",
"autorient flistitl title caption keywords user1 user2 user3 user4".split(" "));function showAllowedExts(){alert(js_vars.h5uM.extallow+js_vars.allowed_file_types.join(", "))}function shide_titlrow(d){var f=$id("titlrow");d.checked?f.style.display="none":f.style.display="table-row"}$(document).ready(function(){H5uSetup()});